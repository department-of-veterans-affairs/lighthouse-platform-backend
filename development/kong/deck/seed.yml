_format_version: "1.1"

services:
  - &service
    host: httpbin.org
    name: httpbin-public-service
    port: 80
    protocol: http
    read_timeout: 1000
    retries: 5
    routes:
      - &route
        name: httpbin-public-route
        paths: [/httpbin/public]
        strip_path: true
        https_redirect_status_code: 426
        path_handling: v1
        request_buffering: true
        response_buffering: true

  - <<: *service
    name: httpbin-protected-service
    plugins:
      - name: key-auth
        enabled: true
        config:
          anonymous: null
          key_in_body: false
          key_in_query: false
          key_in_header: true
          run_on_preflight: true
          hide_credentials: false
          key_names: [apikey]
        protocols: [http, https]
    routes:
      - <<: *route
        name: httpbin-protected-route
        paths: [/httpbin]

  - <<: *service
    host: official-joke-api.appspot.com
    name: joke-api-service
    routes:
      - <<: *route
        methods: [GET]
        name: random-joke
        paths: [/jokes]

consumers:
  - username: &consumer-username kong-consumer
    keyauth_credentials:
      - consumer:
          username: *consumer-username
        key: k0n9_c0nsum3r